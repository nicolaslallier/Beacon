services:
  nginx:
    image: nginx:alpine
    container_name: beacon-library-nginx
    ports:
      - "8181:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - frontend
    networks:
      - beacon-network
      - beacon_library_net
    restart: unless-stopped

  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
      target: ${FRONTEND_TARGET:-dev}
    container_name: beacon-library-frontend
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules
    environment:
      ENV: ${ENV:-local}
      VITE_API_URL: ${VITE_API_URL:-/api}
      VITE_ENABLE_AUTH: ${VITE_ENABLE_AUTH:-false}
      VITE_KEYCLOAK_URL: ${VITE_KEYCLOAK_URL:-http://localhost:8080}
      VITE_KEYCLOAK_REALM: ${VITE_KEYCLOAK_REALM:-beacon}
      VITE_KEYCLOAK_CLIENT_ID: ${VITE_KEYCLOAK_CLIENT_ID:-beacon-library}
    command: ["npm", "run", "dev", "--", "--host", "--port", "3000"]
    expose:
      - "3000"
    networks:
      - beacon-network
      - beacon_library_net
    restart: unless-stopped

volumes:
  frontend_node_modules:
    driver: local

networks:
  beacon-network:
    driver: bridge
  beacon_library_net:
    name: beacon-library_beacon-network
    external: true
